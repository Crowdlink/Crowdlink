<div class="row">
  <ol class="breadcrumb">
    <li><a href="#{[{imp.project.maintainer.get_abs_url()}]}">{[{imp.project.maintainer}]}</a></li>
    <li><a href="#{[{imp.project.get_abs_url()}]}">{[{ imp.project.name }]}</a></li>
    <li><a href="">Improvements</a></li>
    <li class="active">{[{imp.brief}]}</li>
  </ol>
</div>
<div ng-controller="editController" ng-init="init('{[{imp.id}]}', '{[{imp.brief|urlencode}]}', '{[{imp.md|urlencode}]}', '{[{imp.description|urlencode}]}', '{[{imp.open}]}', '{[{imp._close_reason}]}')">
  <div class="row">
    <div class="col-md-8 no-gutter">
      <h2>
        <span ng-hide="imp.can_edit">
          <span ng-show="editing.brief">
            <div class="input-group">
              <input type="text" class="form-control" ng-model="imp.brief" />
              <span class="btn btn-info input-group-addon" ng-click="save('brief')">
                <i class="fa fa-save" ng-hide="saving.brief"></i>
                <i class="fa fa-spinner fa-spin" ng-show="saving.brief"></i>
              </span>
              <span class="btn btn-primary input-group-addon" ng-click="revert('brief')"><i class="fa fa-times-circle"></i></span>
            </div>
          </span>
          <span ng-hide="editing.brief">
            {[{ imp.brief }]}&nbsp;
            <small class="fa fa-edit icon-hover" ng-click="toggle('brief')"></small>
          </span>
        </span>
        <span ng-show="imp.can_edit">
          {[{ imp.brief }]}
        </span>
      </h2>
    </div>
    <div class="col-md-4 no-gutter">
      <div class="pull-right" style="width:50%;">
        <a class="btn btn-default fill-link"
          ng-click="subscribe()"
          ng-class="{true: 'btn-info active', false: 'btn-info'}[imp.subscribed]">
        <span ng-hide="imp.subscribed"><i class="fa fa-eye"></i> &nbsp;Watch</span>
        <span ng-show="imp.subscribed"><i class="fa fa-eye-slash"></i> &nbsp;Unwatch</span>
        </a>
        <a class="btn btn-info fill-link"
          ng-click="vote()"
          ng-class="{true: 'btn-success', false: 'btn-info'}[imp.subscribed]">
          <span ng-hide="imp.vote_status">
            Vote&nbsp;
            <i class="fa fa-plus" ng-show="saving.status"></i>
            <i class="fa fa-minus-circle" ng-hide="saving.status"></i>
          </span>
          <span ng-show="imp.vote_status">
            Unvote&nbsp;
            <i class="fa fa-plus" ng-show="saving.status"></i>
            <i class="fa fa-minus-circle" ng-hide="saving.status"></i>
          </span>
        </a>
        <a class="btn fill-link"
            ng-show="imp.can_edit"
            ng-class="{'btn-danger': status.val, 'btn-success': !status.val}"
            ng-click="swap_save(status)">
          <span ng-show="imp.status">
            <i class="fa fa-minus-circle" ng-hide="status.saving"></i>
            <i class="fa fa-spinner fa-spin" ng-show="status.saving"></i> &nbsp;Close
          </span>
          <span ng-hide="imp.status">
            <i class="fa fa-plus-circle" ng-hide="status.saving"></i>
            <i class="fa fa-spinner fa-spin" ng-show="status.saving"></i> &nbsp;Open
          </span>
        </a>
        <div ng-show="imp.open" class="btn-group-vertical">
          <label class="btn"
            ng-repeat="reason in imp.close_reason"
            ng-class="{true: 'active btn-info', false: 'btn-default'}[imp.close_reason==reason]">
            <input type="radio" ng-model="imp.close_reason" ng-value="reason" class="hide">
            {[{ val }]}
          </label>
        </div>
      </div>
    </div>
  </div>
  <br />
  <div class="row">
    <h4>
      <b>Proposed on </b>{[{ imp.created_at|date:'medium' }]}
      ({[{ imp.created_at|date_ago }]})
    </h4>
    <br>
    <div class="row well well-lg center">
        <div class="row col-lg-11" ng-show="editing.desc">
          <script type="text/javascript" >
            $(document).ready(function() {
              $(".markItUp").markItUp(mySettings);
            });
          </script>
          <textarea class="markItUp" ng-model="imp.desc"></textarea>
          <span class="btn btn-info" ng-click="save(desc)">
            <i class="fa fa-save" ng-hide="desc.saving"></i> &nbsp;Save
            <i class="fa fa-spinner fa-spin" ng-show="desc.saving"></i>
          </span>
          <span class="btn btn-primary" ng-click="revert(desc)">
            <i class="fa fa-times-circle"></i>
            &nbsp;Discard
          </span>
        </div>
        <div ng-hide="desc.editing">
          <i class="fa fa-edit fa-3x icon-hover pull-right" ng-click="toggle(desc)"></i>
          <span ng-bind-html-unsafe="desc.md"></span>
        </div>
        <span ng-hide="imp.can_edit">
          {[{imp.md}]}
        </span>
    </div>
  </div>
</div>
<div class="row" ng-show="imp.events.length > 0">
  <h3>Events</h3>
  <div ng-repeat="event in project.events">
    <span ng-include="'templates/' + event.template" />
  </div>
</div>
<div class="row" ng-show="logged_in">
  <script type="text/javascript" >
    $(document).ready(function() {
      $(".markItUp").markItUp(mySettings);
    });
  </script>
  <textarea class="markItUp" ng-model="new_comment.body"></textarea>
</div>
