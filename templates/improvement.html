{% extends "base.html" %}

{% block title %}View Improvement "{{ imp.brief }}"{% endblock %}
{% block content %}
<div class="row">
  <ol class="breadcrumb">
    <li><a href="{{imp.project.maintainer.get_abs_url()}}">{{imp.project.maintainer}}</a></li>
    <li><a href="{{imp.project.get_abs_url()}}">{{ imp.project.name }}</a></li>
    <li><a href="">Improvements</a></li>
    <li class="active">{{imp.brief}}</li>
  </ol>
</div>
<div ng-app="mainApp" ng-controller="editController" ng-init="init('{{imp.id}}', '{{imp.brief|urlencode}}', '{{imp.md|urlencode}}', '{{imp.description|urlencode}}')">
  <div class="row">
    <div class="col-md-8 no-gutter">
      <h2>
        {% if can_edit %}
        <span ng-show="brief.editing">
          <div class="input-group">
            <input type="text" class="form-control" ng-model="brief.val" />
            <span class="btn btn-info input-group-addon" ng-click="save(brief)">
              <i class="fa fa-save" ng-hide="brief.saving"></i>
              <i class="fa fa-spinner fa-spin" ng-show="brief.saving"></i>
            </span>
            <span class="btn btn-primary input-group-addon" ng-click="revert(brief)"><i class="fa fa-times-circle"></i></span>
          </div>
        </span>
        <span ng-hide="brief.editing">
          {[{ brief.val }]}&nbsp;
          <small class="fa fa-edit icon-hover" ng-click="toggle(brief)"></small>
        </span>
        {% else %}
          {{ imp.brief }}
        {% endif %}
      </h2>
    </div>
    <div class="col-md-4 no-gutter">
      <div class="btn-group-vertical pull-right" style="width:50%;">
        <a class="btn btn-default"
            data-type="watch"
            data-json="{{imp.jsonize(url_key=1, project=1, subscribed=1)}}"
            data-url="improvement">
          <span class="false-div"><i class="fa fa-eye"></i> &nbsp;Watch</span>
          <span class="true-div"><i class="fa fa-eye-slash"></i> &nbsp;Unwatch</span>
        </a>
        <a data-json="{{imp.jsonize(url_key=1, project=1, vote_status=1)}}"
            data-type="vote"
            class="btn btn-info">
          <span class="false-div"><i class="fa fa-plus"></i> &nbsp;Vote</span>
          <span class="true-div"><i class="fa fa-minus"></i> &nbsp;Unvote</span>
        </a>
      </div>
    </div>
  </div>
  <br />
  <div class="row">
    <h4>
      <b>Proposed on </b>{{ imp.created_at|date }}
      ({{ imp.created_at|date_ago }})
    </h4>
    <br>
    <div class="row well center">
        {% if can_edit %}
        <div class="row col-lg-11" ng-show="desc.editing">
          <script type="text/javascript" >
            $(document).ready(function() {
              $(".markItUp").markItUp(mySettings);
            });
          </script>
          <textarea class="markItUp" ng-model="desc.val"></textarea>
          <span class="btn btn-info" ng-click="save(desc)">
            <i class="fa fa-save" ng-hide="desc.saving"></i> &nbsp;Save
            <i class="fa fa-spinner fa-spin" ng-show="desc.saving"></i>
          </span>
          <span class="btn btn-primary" ng-click="revert(desc)"><i class="fa fa-times-circle"></i> &nbsp;Discard</span>
        </div>
        <div ng-hide="desc.editing">
          <i class="fa fa-edit fa-3x icon-hover pull-right" ng-click="toggle(desc)"></i>
          <span ng-bind-html-unsafe="desc.md"></span>
        </div>
        {% else %}
        {{imp.md|safe}}
        {% endif %}
    </div>
    {% if can_edit %}
    {% endif %}
  </div>
</div>
{% if events %}
<div class="row">
  <h3>Events</h3>
  {% for event in imp.events %}
    {% include event.template %}
  {% endfor %}
</div>
{% endif %}
<div class="row">
  {{ comment_form|safe }}
</div>
{% endblock %}
