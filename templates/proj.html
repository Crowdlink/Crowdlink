{% extends "base.html" %}

{% block title %}Home{% endblock %}
{% block post_script %}
<script type="text/javascript" charset="utf-8">
$(function () {
  window.improvements.reset({{project.get_improvements().to_json()|safe}})
});
</script>
{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-8 no-gutter">
    <h2>
      {{ project.name }}
    </h2>
    <h4>
      <b>Created </b>{{ project.created_at|date }}
      ({{ project.created_at|date_ago }})
    </h4>
    <h4>
      <b>Maintainer </b>
      <a href="{{ project.maintainer.get_abs_url() }}">{{ project.maintainer.username }}</a>
    </h4>
  </div>
  <div class="col-md-4 no-gutter">
    <br />
    <div class="btn-group-vertical pull-right" style="width:70%;">
      <a class="btn btn-default"
            data-type="watch"
            data-json="{{project.jsonize(id=1, subscribed=1)}}"
            data-url="project">
        <span class="false-div"><i class="fa fa-eye"></i> &nbsp;Watch</span>
        <span class="true-div"><i class="fa fa-eye-slash"></i> &nbsp;Unwatch</span>
      </a>
      <a class="btn btn-default" href="{{url_for('main.project_settings',
                                                 username=project.maintainer.username,
                                                 url_key=project.url_key)}}">
        <i class="fa fa-large fa-gear"></i>
        Project Settings
      </a>
    </div>
  </div>
</div>
<div class="row">
  <h3>Improvements</h3>
  <div class="input-group">
    <form>
    <input id="improvement_search"
        type="text"
        data-project="{{project.id}}"
        class="form-control" />
    </form>
  <table class="table table-hover" ng-controller="ImpCtrl">
    <tbody>
     <tr ng-repeat="imp in imps">
      <td class="fit-width">
        <a data-vote-status="{{ vote_status }}"
           data-url-key="{{ url_key }}"
           data-project="{{ project }}"
           data-type="vote"
           class="btn btn-xs btn-info">
          <span class="false-div">Vote&nbsp; <i class="fa fa-plus"></i></span>
          <span class="true-div">Unvote&nbsp; <i class="fa fa-minus"></i></span>
        </a>
        &nbsp;&nbsp;
        <b><%= imp.attributes.votes %> votes</b>
      </td>
      <td><a href="<%= imp.attributes.get_abs_url %>"><% imp.attributes.brief %></a></td>
    </tr>
    <% }); %>
    </tbody>
  </table>
    <span class="btn btn-info input-group-addon">
      <i class="fa fa-search"></i>
    </span>
  </div><!-- /input-group -->
</div>
{% if project.events %}
<div class="row">
  <h3>Events</h3>
  {% for event in project.events %}
    {% include event.template %}
  {% endfor %}
</div>
{% endif %}
{% endblock %}
